{% extends 'base.html' %}
{% load format_helpers %}
{% load humanize %}

{% block title %}Revisión de Solicitud de Préstamo{% endblock %}

{% block content %}

<header class="page-header">
    <div class="header-content">
        <h1>Revisión de Solicitud #{{ prestamo.id }}</h1>
        <p>Evalúa los detalles de la solicitud y toma una decisión.</p>
    </div>
</header>

<div class="mb-4">
    <a href="{% url 'loan_application_list' %}" class="btn btn-sm btn-outline-secondary">Volver a la lista de solicitudes</a>
</div>

{% include 'includes/_messages.html' %}

<div class="content-container">
    <div class="details-card">
        <h3>Información de la Solicitud</h3>
        <div class="details-list">
            <div class="details-list-item">
                <span class="details-list-label"><i class="fas fa-user" style="margin-right: 8px;"></i>Cliente</span>
                <span class="details-list-value">{{ prestamo.cliente.nombres }} {{ prestamo.cliente.apellidos }}</span>
            </div>
            <div class="details-list-item">
                <span class="details-list-label"><i class="fas fa-folder-open" style="margin-right: 8px;"></i>Tipo de Préstamo</span>
                <span class="details-list-value">{{ prestamo.tipo_prestamo.nombre|default:"N/A" }}</span>
            </div>
            <div class="details-list-item">
                <span class="details-list-label"><i class="fas fa-file-invoice-dollar" style="margin-right: 8px;"></i>Monto Solicitado</span>
                <span class="details-list-value">${{ prestamo.monto|format_number }}</span>
            </div>
            <div class="details-list-item">
                <span class="details-list-label"><i class="fas fa-calendar-alt" style="margin-right: 8px;"></i>Plazo</span>
                <span class="details-list-value">{{ prestamo.plazo }} meses</span>
            </div>
            <div class="details-list-item">
                <span class="details-list-label"><i class="fas fa-calendar-day" style="margin-right: 8px;"></i>Fecha de Solicitud</span>
                <span class="details-list-value">{{ prestamo.fecha_creacion|date:"d/m/Y" }}</span>
            </div>
            <div class="details-list-item">
                <span class="details-list-label"><i class="fas fa-info-circle" style="margin-right: 8px;"></i>Estado</span>
                <span class="details-list-value">{{ prestamo.get_estado_display }}</span>
            </div>
        </div>
    </div>

    <!-- Acciones de Aprobación/Rechazo -->
    <div class="details-card" style="margin-top: 2rem;">
        <h3>Acciones</h3>
        <p>Una vez que tomes una decisión, el estado de la solicitud cambiará y no se podrá revertir.</p>
        <div class="mt-3">
            <form method="POST" action="{% url 'loan_application_approve' pk=prestamo.id %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-success">Aprobar Solicitud</button>
            </form>
            <form method="POST" action="{% url 'loan_application_reject' pk=prestamo.id %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">Rechazar Solicitud</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
