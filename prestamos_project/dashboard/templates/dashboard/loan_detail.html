{% extends 'base.html' %}
{% load humanize %}

{% block title %}Detalles del Préstamo{% endblock %}

{% block content %}
<header class="page-header">
    <div class="header-content">
        <h1>Detalles del Préstamo #{{ prestamo.id }}</h1>
        <p>Información detallada del préstamo y su tabla de amortización.</p>
    </div>
    <div class="header-actions">
        <a href="{% url 'payment_add' %}?loan_id={{ prestamo.id }}" class="btn btn-primary">Registrar Pago</a>
    </div>
</header>

<div class="content-container">
    <div class="loan-details">
        <h3>Información del Préstamo</h3>
        <p><strong>Cliente:</strong> {{ prestamo.cliente.nombres }} {{ prestamo.cliente.apellidos }}</p>
        <p><strong>Monto:</strong> ${{ prestamo.monto|intcomma }}</p>
        <p><strong>Tasa de Interés:</strong> {{ prestamo.tasa_interes }}%</p>
        <p><strong>Plazo:</strong> {{ prestamo.plazo }} meses</p>
        <p><strong>Frecuencia de Pago:</strong> {{ prestamo.frecuencia_pago|capfirst }}</p>
        <p><strong>Fecha de Desembolso:</strong> {{ prestamo.fecha_desembolso|date:"d/m/Y" }}</p>
        <p><strong>Estado:</strong> {{ prestamo.estado|capfirst }}</p>
        <p><strong>Ganancia Total Estimada:</strong> <span style="color: #28a745; font-weight: bold;">${{ ganancia_total|intcomma }}</span></p>
        <p><strong>Monto Total Pagado:</strong> <span style="color: #007bff; font-weight: bold;">${{ total_pagado_real|intcomma }}</span></p>
    </div>

    <h3 style="margin-top: 2rem;">Tabla de Amortización</h3>
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Cuota #</th>
                    <th>Fecha Vencimiento</th>
                    <th>Cuota Fija</th>
                    <th>Capital</th>
                    <th>Interés</th>
                    <th>Saldo Pendiente</th>
                </tr>
            </thead>
            <tbody>
                {% for cuota in tabla_amortizacion %}
                <tr>
                    <td>{{ cuota.numero_cuota }}</td>
                    <td>{{ cuota.fecha_vencimiento|date:"d/m/Y" }}</td>
                    <td>${{ cuota.cuota_fija|intcomma }}</td>
                    <td>${{ cuota.capital|intcomma }}</td>
                    <td>${{ cuota.interes|intcomma }}</td>
                    <td>${{ cuota.saldo_pendiente|intcomma }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}