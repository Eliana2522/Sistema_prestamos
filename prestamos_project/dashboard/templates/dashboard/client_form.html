{% extends 'base.html' %}

{% block title %}{% if form.instance.pk %}Editar Cliente{% else %}Registrar Cliente{% endif %}{% endblock %}

{% block content %}
<header class="page-header mb-4">
    <h1><i class="fa-solid fa-user-plus"></i> {% if form.instance.pk %}Editar Cliente{% else %}Registrar Cliente{% endif %}</h1>
    <p class="text-muted">Rellena los campos para registrar o actualizar un cliente en el sistema.</p>
</header>

<div class="mb-4">
    <a href="javascript:history.back()" class="btn btn-sm btn-outline-secondary">Volver</a>
</div>

<div class="card shadow">
    <div class="card-body">
        <!-- El formulario envía los datos a la misma URL por el método POST -->
        <form method="post" novalidate>
            <!-- Token de seguridad de Django -->
            {% csrf_token %}

            {% include 'includes/_messages.html' %}

            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.nombres.id_for_label }}" class="form-label">{{ form.nombres.label }}</label>
                    {{ form.nombres }}
                    {% if form.nombres.errors %}<div class="invalid-feedback d-block">{{ form.nombres.errors.as_text }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.apellidos.id_for_label }}" class="form-label">{{ form.apellidos.label }}</label>
                    {{ form.apellidos }}
                    {% if form.apellidos.errors %}<div class="invalid-feedback d-block">{{ form.apellidos.errors.as_text }}</div>{% endif %}
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.apodo.id_for_label }}" class="form-label">{{ form.apodo.label }}</label>
                    {{ form.apodo }}
                    {% if form.apodo.errors %}<div class="invalid-feedback d-block">{{ form.apodo.errors.as_text }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.fecha_nacimiento.id_for_label }}" class="form-label">{{ form.fecha_nacimiento.label }}</label>
                    {{ form.fecha_nacimiento }}
                    {% if form.fecha_nacimiento.errors %}<div class="invalid-feedback d-block">{{ form.fecha_nacimiento.errors.as_text }}</div>{% endif %}
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.sexo.id_for_label }}" class="form-label">{{ form.sexo.label }}</label>
                    {{ form.sexo }}
                    {% if form.sexo.errors %}<div class="invalid-feedback d-block">{{ form.sexo.errors.as_text }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.estado_civil.id_for_label }}" class="form-label">{{ form.estado_civil.label }}</label>
                    {{ form.estado_civil }}
                    {% if form.estado_civil.errors %}<div class="invalid-feedback d-block">{{ form.estado_civil.errors.as_text }}</div>{% endif %}
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.tipo_documento.id_for_label }}" class="form-label">{{ form.tipo_documento.label }}</label>
                    {{ form.tipo_documento }}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.numero_documento.id_for_label }}" class="form-label">{{ form.numero_documento.label }}</label>
                    {{ form.numero_documento }}
                    <small id="docHelp" class="form-text text-muted"></small>
                    {% if form.numero_documento.errors %}<div class="invalid-feedback d-block">{{ form.numero_documento.errors.as_text }}</div>{% endif %}
                </div>
            </div>

            <div class="mb-3">
                <label for="{{ form.direccion.id_for_label }}" class="form-label">{{ form.direccion.label }}</label>
                {{ form.direccion }}
            </div>

            <div class="mb-3">
                <label for="{{ form.telefono.id_for_label }}" class="form-label">{{ form.telefono.label }}</label>
                {{ form.telefono }}
                {% if form.telefono.errors %}<div class="invalid-feedback d-block">{{ form.telefono.errors.as_text }}</div>{% endif %}
            </div>

            <hr>
            <h5 class="mb-3">Información Laboral</h5>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.nombre_empresa.id_for_label }}" class="form-label">{{ form.nombre_empresa.label }}</label>
                    {{ form.nombre_empresa }}
                    {% if form.nombre_empresa.errors %}<div class="invalid-feedback d-block">{{ form.nombre_empresa.errors.as_text }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.cargo.id_for_label }}" class="form-label">{{ form.cargo.label }}</label>
                    {{ form.cargo }}
                    {% if form.cargo.errors %}<div class="invalid-feedback d-block">{{ form.cargo.errors.as_text }}</div>{% endif %}
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.telefono_trabajo.id_for_label }}" class="form-label">{{ form.telefono_trabajo.label }}</label>
                    {{ form.telefono_trabajo }}
                    {% if form.telefono_trabajo.errors %}<div class="invalid-feedback d-block">{{ form.telefono_trabajo.errors.as_text }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.ingresos_mensuales.id_for_label }}" class="form-label">{{ form.ingresos_mensuales.label }}</label>
                    {{ form.ingresos_mensuales }}
                    {% if form.ingresos_mensuales.errors %}<div class="invalid-feedback d-block">{{ form.ingresos_mensuales.errors.as_text }}</div>{% endif %}
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.fecha_ingreso_trabajo.id_for_label }}" class="form-label">{{ form.fecha_ingreso_trabajo.label }}</label>
                    {{ form.fecha_ingreso_trabajo }}
                    {% if form.fecha_ingreso_trabajo.errors %}<div class="invalid-feedback d-block">{{ form.fecha_ingreso_trabajo.errors.as_text }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3 form-check align-self-center">
                    {{ form.trabajo_actual }}
                    <label for="{{ form.trabajo_actual.id_for_label }}" class="form-check-label">{{ form.trabajo_actual.label }}</label>
                    {% if form.trabajo_actual.errors %}<div class="invalid-feedback d-block">{{ form.trabajo_actual.errors.as_text }}</div>{% endif %}
                </div>
            </div>
            
            <div class="form-actions border-top pt-3 mt-3">
                <button type="submit" class="btn btn-primary">Guardar Cliente</button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tipoDocumento = document.getElementById('{{ form.tipo_documento.id_for_label }}');
    const docHelp = document.getElementById('docHelp');

    function updateHelpText() {
        if (tipoDocumento.value === 'cedula') {
            docHelp.textContent = 'Debe contener 11 dígitos numéricos.';
        } else if (tipoDocumento.value === 'pasaporte') {
            docHelp.textContent = 'Debe contener 8 caracteres alfanuméricos.';
        }
    }

    // Actualizar al cargar la página y al cambiar la selección
    updateHelpText();
    tipoDocumento.addEventListener('change', updateHelpText);
});
</script>

{% endblock %}